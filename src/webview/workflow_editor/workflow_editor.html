<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Actions Workflow Editor</title>
    <link rel="stylesheet" href="../common/common.css">
    <link rel="stylesheet" href="workflow_editor.css">
</head>
<body>
    <div class="container">
        <!-- Ï¢åÏ∏° ÏÇ¨Ïù¥ÎìúÎ∞î -->
        <div class="sidebar">
            <div class="sidebar-header">
                Workflows
            </div>
            <div class="workflow-list">
                <div class="workflow-item active">
                    <span class="workflow-icon">üèóÔ∏è</span>
                    <span>Build and Test</span>
                </div>
                <div class="workflow-item">
                    <span class="workflow-icon">üöÄ</span>
                    <span>Deploy to Production</span>
                </div>
                <div class="workflow-item">
                    <span class="workflow-icon">üè∑Ô∏è</span>
                    <span>Release</span>
                </div>
                <div class="workflow-item">
                    <span class="workflow-icon">üåô</span>
                    <span>Nightly Build</span>
                </div>
                <div class="workflow-item">
                    <span class="workflow-icon">üîÑ</span>
                    <span>CI/CD Pipeline</span>
                </div>
            </div>
        </div>

        <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
        <div class="main-content">
            <div class="main-header">
                <h1>Workflow Editor</h1>
            </div>
            <div class="editor-content">
                <!-- Trigger ÏÑπÏÖò -->
                <div class="form-section">
                    <h3>Trigger</h3>
                    <div class="form-group">
                        <label>Configure the events that trigger this workflow</label>
                        <select class="form-control">
                            <option>Push</option>
                            <option>Pull Request</option>
                            <option>Schedule</option>
                            <option>Manual</option>
                        </select>
                    </div>
                </div>

                <!-- Event ÏÑπÏÖò -->
                <div class="form-section">
                    <h3>Event</h3>
                    <div class="form-group">
                        <select class="form-control">
                            <option>Select...</option>
                            <option>push</option>
                            <option>pull_request</option>
                            <option>schedule</option>
                            <option>workflow_dispatch</option>
                        </select>
                    </div>
                </div>

                <!-- Branch ÏÑπÏÖò -->
                <div class="form-section">
                    <h3>Branch</h3>
                    <div class="form-group">
                        <select class="form-control">
                            <option>Select...</option>
                            <option>main</option>
                            <option>develop</option>
                            <option>feature/*</option>
                        </select>
                    </div>
                </div>

                <!-- Cron Expression -->
                <div class="form-section">
                    <h3>Cron Expression</h3>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Enter cron expression..." value="cronexpression">
                    </div>
                </div>

                <!-- Jobs ÏÑπÏÖò -->
                <div class="form-section">
                    <h3>Jobs</h3>
                    <div class="jobs-section">
                        <div class="job-item">
                            <div class="job-header">
                                <div class="job-icon">
                                    <span>üë§</span>
                                </div>
                                <div>
                                    <div style="font-weight: 600;">Job 1</div>
                                    <div style="font-size: 11px; color: #888;">Drag and drop to reorder jobs</div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Job Name</label>
                                <input type="text" class="form-control" placeholder="Enter job name..." value="jobname">
                            </div>

                            <div class="form-group">
                                <label>Runs On</label>
                                <select class="form-control">
                                    <option>Select...</option>
                                    <option>ubuntu-latest</option>
                                    <option>windows-latest</option>
                                    <option>macos-latest</option>
                                </select>
                            </div>

                            <!-- Environment Variables -->
                            <div class="form-group">
                                <label>Environment Variables</label>
                                <table class="steps-table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Value</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>ENV_VAR_1</td>
                                            <td>value1</td>
                                        </tr>
                                        <tr>
                                            <td>ENV_VAR_2</td>
                                            <td>value2</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Steps ÏÑπÏÖò -->
                <div class="form-section">
                    <h3>Steps</h3>
                    <table class="steps-table">
                        <thead>
                            <tr>
                                <th>Step Name</th>
                                <th>Action</th>
                                <th>Inputs</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Checkout Code</td>
                                <td>actions/checkout@v3</td>
                                <td>github-token</td>
                            </tr>
                            <tr>
                                <td>Setup Node.js</td>
                                <td>actions/setup-node@v3</td>
                                <td>node-version: 18</td>
                            </tr>
                            <tr>
                                <td>Run Tests</td>
                                <td>npm run test</td>
                                <td>-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Action ÏÑπÏÖò -->
                <div class="form-section">
                    <h3>Action</h3>
                    <div class="form-group">
                        <select class="form-control">
                            <option>Select...</option>
                            <option>actions/checkout</option>
                            <option>actions/setup-node</option>
                            <option>actions/upload-artifact</option>
                        </select>
                    </div>
                </div>

                <!-- Custom Script -->
                <div class="form-section">
                    <h3>Custom Script</h3>
                    <div class="form-group">
                        <textarea class="form-control" rows="4" placeholder="Enter custom script..."></textarea>
                    </div>
                </div>

                <!-- Timeout -->
                <div class="form-section">
                    <h3>Timeout</h3>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Enter timeout..." value="timeout-in">
                    </div>
                </div>

                <div style="margin-top: 30px;">
                    <button class="btn">Save</button>
                    <button class="btn btn-secondary" style="margin-left: 10px;">Discard</button>
                </div>
            </div>
        </div>

        <!-- Ïö∞Ï∏° Ìå®ÎÑê -->
        <div class="right-panel">
            <!-- Quick Links -->
            <div class="panel-section">
                <h3>Quick Links</h3>
                <ul class="quick-links">
                    <li><a href="#">Workflow Documentation ‚Üí</a></li>
                    <li><a href="#">CI/CD Best Practices ‚Üí</a></li>
                </ul>
            </div>

            <!-- LLM Prompt -->
            <div class="panel-section">
                <h3>LLM Prompt</h3>
                <div class="llm-prompt"></div>
                <button class="btn" style="margin-top: 10px;">Submit</button>
            </div>

            <!-- Settings -->
            <div class="panel-section">
                <h3>Settings</h3>
                <div class="settings-toggle">
                    <span>Theme</span>
                    <span>System</span>
                </div>
                <div class="settings-toggle">
                    <span>Notifications</span>
                    <div class="toggle active"></div>
                </div>
            </div>

            <!-- Live YAML Preview -->
            <div class="panel-section" style="flex: 1;">
                <h3>Live YAML Preview</h3>
                <div class="yaml-preview">
name: Build and Test
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    - run: npm install
    - run: npm test
                </div>
            </div>
        </div>
    </div>

    <script>
        // VS Code API Í∞ÄÏ†∏Ïò§Í∏∞
        const vscode = acquireVsCodeApi();

        // ÏõåÌÅ¨ÌîåÎ°úÏö∞ ÏïÑÏù¥ÌÖú ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
        document.querySelectorAll('.workflow-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.workflow-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                
                // ÏÑ†ÌÉùÎêú ÏõåÌÅ¨ÌîåÎ°úÏö∞Ïóê Îî∞Îùº YAML ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÖÎç∞Ïù¥Ìä∏
                updateYamlPreview(this.textContent.trim());
            });
        });

        // ÌÜ†Í∏Ä Î≤ÑÌäº Ïù¥Î≤§Ìä∏
        document.querySelectorAll('.toggle').forEach(toggle => {
            toggle.addEventListener('click', function() {
                this.classList.toggle('active');
            });
        });

        // Ìèº ÏûÖÎ†• Ïãú YAML ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÖÎç∞Ïù¥Ìä∏
        document.querySelectorAll('.form-control').forEach(input => {
            input.addEventListener('input', function() {
                generateYamlPreview();
            });
        });

        // LLM Prompt Ï†úÏ∂ú
        document.querySelector('.panel-section .btn').addEventListener('click', function() {
            const prompt = document.querySelector('.llm-prompt').textContent;
            vscode.postMessage({
                command: 'submitPrompt',
                text: prompt || 'GitHub Actions workflow analysis request'
            });
        });

        // Workflow Ï†ÄÏû•
        document.querySelector('.btn').addEventListener('click', function() {
            if (this.textContent === 'Save') {
                vscode.postMessage({
                    command: 'saveWorkflow',
                    workflow: generateWorkflowData()
                });
            }
        });

        // YAML ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        function updateYamlPreview(workflowName) {
            const yamlPreview = document.querySelector('.yaml-preview');
            const workflows = {
                'üèóÔ∏è Build and Test': `name: Build and Test
on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    - run: npm ci
    - run: npm test
    - run: npm run build`,
                'üöÄ Deploy to Production': `name: Deploy to Production
on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: production
    steps:
    - uses: actions/checkout@v3
    - name: Deploy to server
      run: |
        echo "Deploying to production..."
        # deployment scripts here`,
                'üè∑Ô∏è Release': `name: Release
on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Create Release
      uses: actions/create-release@v1
      with:
        tag_name: \${{ github.ref }}
        release_name: Release \${{ github.ref }}`,
                'üåô Nightly Build': `name: Nightly Build
on:
  schedule:
    - cron: '0 2 * * *'

jobs:
  nightly:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Run nightly tests
      run: npm run test:nightly`,
                'üîÑ CI/CD Pipeline': `name: CI/CD Pipeline
on:
  push:
  pull_request:

jobs:
  ci:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - run: npm ci
    - run: npm test
  
  cd:
    if: github.ref == 'refs/heads/main'
    needs: ci
    runs-on: ubuntu-latest
    steps:
    - run: echo "Deploying..."`
            };
            
            yamlPreview.textContent = workflows[workflowName] || workflows['üèóÔ∏è Build and Test'];
        }

        // ÎèôÏ†Å YAML ÏÉùÏÑ± Ìï®Ïàò
        function generateYamlPreview() {
            const trigger = document.querySelector('select.form-control').value;
            const jobName = document.querySelector('input[placeholder="Enter job name..."]').value || 'job';
            const runsOn = document.querySelector('select.form-control:nth-of-type(3)').value || 'ubuntu-latest';
            
            const yaml = `name: ${document.querySelector('.workflow-item.active').textContent.trim()}
on: ${trigger.toLowerCase()}

jobs:
  ${jobName}:
    runs-on: ${runsOn}
    steps:
    - uses: actions/checkout@v3
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    - run: npm install
    - run: npm test`;
            
            document.querySelector('.yaml-preview').textContent = yaml;
        }

        // ÏõåÌÅ¨ÌîåÎ°úÏö∞ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± Ìï®Ïàò
        function generateWorkflowData() {
            return {
                name: document.querySelector('.workflow-item.active').textContent.trim(),
                trigger: document.querySelector('select.form-control').value,
                jobs: [{
                    name: document.querySelector('input[placeholder="Enter job name..."]').value || 'job',
                    runsOn: document.querySelector('select.form-control:nth-of-type(3)').value || 'ubuntu-latest'
                }]
            };
        }

        // Ï¥àÍ∏∞ YAML ÎØ∏Î¶¨Î≥¥Í∏∞ ÏÑ§Ï†ï
        updateYamlPreview('üèóÔ∏è Build and Test');
    </script>
</body>
</html>
